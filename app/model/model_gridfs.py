"""
model_grids.py
"""
#!/usr/bin/env python
# model_gridfs.py
import mimetypes
import gridfs
import requests

FPATH = "report/"

class ModelGridFS():
    """
    empty
    """

    def __init__(self, db):
        self._db = db

    def get_file_from_gridfs(self, id_file):
        """ Get file from gridfs
        Params:
        -db, id_file
        Returns:
        -
        """
        fs = gridfs.GridFS(self._db)
        f = fs.find_one({"filename" : id_file})
        return f

    def file_from_db_to_hd(self, fname):
        fs = gridfs.GridFSBucket(self._db)
        file = open(FPATH + fname, 'wb+')
        fs.download_to_stream_by_name(fname, file)

    def add_malware_file(self, file_url, file_name):
        """
        empty
        """
        try:
            fs = gridfs.GridFS(self._db)
            r = requests.get(file_url, stream=True, allow_redirects=True, timeout=2)
            mime_type = mimetypes.guess_type(file_url)
            print(FPATH + file_name)
            with open(FPATH + file_name, "wb") as tmp_file:
                for chunk in r.iter_content(chunk_size=1024):
                    if chunk:
                        tmp_file.write(chunk)
            with open(FPATH + file_name, "rb") as tmp_file:
                _id = fs.put(tmp_file, contentType=mime_type, filename=file_name)
                return _id
        except:
            print("Error while download the file")
